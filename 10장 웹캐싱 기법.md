# 목차

<br>

- [목차](#목차)
- [웹 캐싱](#웹-캐싱)
- [웹캐시의 교체 알고리즘](#웹캐시의-교체-알고리즘)
  - [1 교체 알고리즘의 성능 척도](#1-교체-알고리즘의-성능-척도)
  - [2 참조 가능성의 예측](#2-참조-가능성의-예측)
  - [3 객체의 이질성에 대한 고려](#3-객체의-이질성에-대한-고려)
  - [4 알고리즘의 시간 복잡도](#4-알고리즘의-시간-복잡도)
- [웹 캐시의 일관성 유지 기법](#웹-캐시의-일관성-유지-기법)
- [웹 캐시의 공유 및 협력 기법](#웹-캐시의-공유-및-협력-기법)
- [웹 캐시의 사전인출 기법](#웹-캐시의-사전인출-기법)
- [동적 웹 객체의 캐싱 기법](#동적-웹-객체의-캐싱-기법)

<br>

# 웹 캐싱

- **웹캐싱** : 웹 사용자에 의해 빈번히 요청되는 데이터를 사용자와 지리적으로 가까운 웹캐시 서버에 보관해 빠른 서비스를 가능하게 하는 기법

- **프락시서버** : 통상적으로 일개 **그룹의 웹 사용자에 대한 서비스 지연시간을 줄이기 위해** 사용 ⇒ 네트워크의 **대역폭 절약**과 함께 **웹서버의 부하를 줄이는 역할**

- **역방향 프락시캐시** : 일개 **그룹에 속한 웹서버의 객체들을 캐싱**하여 서버의 부하를 직접적으로 줄이는 역할 ⇒ 웹 사용자의 지연시간을 줄이는 역할

- 캐시 교체 알고리즘

   (cache replacement algorithm) : 한정된 캐시 공간을 가지고 사용자들의 지속적인 요청을 처리하기 위해 어떠한 객체를 캐시에 보관하고 어떠한 객체를 캐시에서 삭제할지 온라인으로 결정

  - **일관성 유지 기법** : 사용자가 요청한 웹 객체가 캐싱되어 있는 경우 이 객체가 근원지 서버에 있는 객체와 동일한지를 확인해 사용자에게 최신의 정보 전달

<br>

# 웹캐시의 교체 알고리즘

캐싱 기법의 성능은 캐시 알고리즘에 의해 크게 좌우된다. 캐시 교체 알고리즘은 미래의 참조를 미리 알지 못하는 상태에서 한정된 캐시 공간에 보관하고 있을 객체와 삭제할 객체를 동적으로 결정하는 온라인 알고리즘이다.

<br>

## 1 교체 알고리즘의 성능 척도

1. `캐시적중률` : (캐시에서 적중되어 서비스된 요청/사용자의 총 요청) * 100
2. `바이트 적중률` : (캐시에 이미 존재해 근원지 서버에서 받아올 필요가 없는 바이트 수/사용자의 총 요청 바이트 수) * 100
3. `지연 감소율` : (캐시가 있어서 줄어든 지연시간/캐시가 없을 경우의 총 사용자 지연시간) * 100
4. `비용절감률` : 객체들의 참조가능성과 이질성을 함께 고려해서 평가한 객체들의 가치

- 전통적 캐싱 환경 : 참조 가능성이 높은 객체를 보관해 `캐시적중률` 높이는 것이 목표
- 웹 캐싱 환경 : 객체의 이질성을 고려할 수 있는 `비용절감률` 높이는 것이 목표

<br>

## 2 참조 가능성의 예측

캐시 교체 알고리즘은 궁극적으로 참조 가능성을 얼마나 잘 예측하는가에 좌우된다. 일반적으로 과거 참조 기록을 통해 예측을 한다.

- 시간지역성 (temporal locality) : 최근 참조된 객체가 다시 참조될 가능성이 높다
- 인기도 (popularity) : 참조 횟수가 많은 객체일수록 또다시 참조될 가능성이 높다

<br>

1. LRU 알고리즘
   * 최근에 참조된 객체에 높은 가치를 부여
   * 최근 참조 성향만을 고려

2. LFU 알고리즘
   * 참조 횟수가 많은 객체에 높은 가치를 부여
   * 참조 횟수가 가장 적은 객체를 캐시에서 삭제
   * 참조 횟수만 고려

3. LRFU 알고리즘
   * 각각의 참조 시점을 그 최근성에 근거해 고려한다.
   * 과거 시점에서의 각각의 참조가 현재 객체의 참조가능성을 예측하는데 기여하게 되며, 최근의 참조일수록 기여도를 더 높게 계산한다.
   * 최근 참조성향, 참조횟수 두 가지를 함께 고려

웹 캐싱의 알고리즘은 시간지역성 관점에서 객체 직전 참조 시각을 활용한다.
이후의 알고리즘들은 시간 지역성과 참조 인기도를 모두 고려해서 객체의 참조 가능성을 예측한다.

<br>

## 3 객체의 이질성에 대한 고려

페이징 시스템과 같은 전통적인 캐싱 환경에서는 사용자가 요청한 객체가 캐시에 존재하는 경우 그 효용이 모두 동일하므로, 캐시 교체 알고리즘은 참조 가능성이 높은 객체를 캐시에 보관하는 것으로 충분하다. 하지만 웹캐싱에서처럼 캐싱의 단위 객체들이 이질적인 환경에서는 참조 가능성 이외에 객체의 크기와 인출 비용을 고려한 합리적인 가치평가를 해야 한다. 즉 객체를 캐시에 보관하고 있을지 여부를 결정하는 가치평가 기준은, **객체의 참조 가능성에 의한 가치와 캐시에서 적중될 경우 실제로 절약할 수 있는 비용을 동시에 고려해야 한다는 것이다.**

<br>

## 4 알고리즘의 시간 복잡도

캐시 교체 알고리즘이 실제 시스템에 유효하게 사용되기 위해서는 시간 복잡도 측면에서 현실성이 있어야 한다. 이는 캐싱 알고리즘이 온라인 알고리즘으로서 빈 공간이 필요할 때마다 즉시 삭제할 객체를 선별해야 해서 시간적인 제약 조건이 따르게 되기 때문이다. 

<br>

# 웹 캐시의 일관성 유지 기법

1. 강한 일관성 유지 기법 (strong consistency)
   - 반드시 최신 정보가 사용자에게 전달되는 것을 보장하는 기법
   - ❌ 웹서버와 네트워크의 부담이 커서 일반적으로 잘 사용하지 않음
   - 기법
     - polling-every-time: 이 기법은 캐시 내에 이미 존재하는 객체에 대한 요청이 있을 때마다 근원지 서버에 객체의 변경 여부를 확인하는 방법이다.
     - invalidation: 이 기법은 근원지 서버가 자신의 객체를 캐싱하고 있는 모든 프락시서버를 기록해두었다가, 해당 객체가 변경된 경우 해당 프락시서버들에 변경 사실을 알려주는 방법이다. 
2. 약한 일관성 유지 기법 (weak consistency)
   - 사용자의 요청이 있을 때마다 캐싱된 객체가 변경되었는지 근원지 서버에 일일이 확인하지 않고, 변경되었을 가능성이 높은 경우만 확인하는 기법
   - 기법
     - adaptive TTL: 이 기법은 캐시 내에 이미 존재하는 객체에 대한 요청이 있을 대, 해당 객체에 대한 최종 변경 시각과 최종 확인 시각을 고려해서 변경되었을 가능성이 높다고 판단되는 경우에만 근원지 서버에 변경 여부를 확인하는 방법이다. 

<br>

> **polling-every-time**과 **invalidation** 기법은 사용자에게 변경되기 이전의 정보를 제공할 가능성이 없는 강한 일관성 유지 기법이지만, polling-every-time의 경우 변경 여부를 매번 근원지 서버에 확인하는 과정에서 사용자 지연시간 증가와 네트워크 유통량 증가, 웹서버의 과부하 문제 등을 야기한다. 또한 invalidation 기법의 경우 근원지 서버가 객체를 캐싱하고 있는 모든 프락시 서버를 기억하고 있어야 하는 부담이 있다. 
>
>  따라서 대부분의 사용 프락시 서버들은 약한 일관성 유지 기법인 adaptive TTL 방법을 주로 사용한다.

<br>

# 웹 캐시의 공유 및 협력 기법

- ICP (Internet Cache Protocol, 인터넷 캐시 프로토콜)
  - 동료 프락시캐시들 사이에서 웹 객체의 검색 및 전송을 지원하기 위한 프로토콜
  - 사용자가 프락시서버에 웹 객체를 요구했는데 없는 경우, 모든 동료 프락시들에게 ICP 질의를 멀티캐스트해서 누가 요청된 웹 객체를 가지고 있는지 확인 > 요청된 객체를 가지고 있다는 답신이 오면, 질의를 보냈던 프락시는 해당 프락시에게 HTTP 요청을 보내 객체를 받아 사용자에게 전달
- CARP (Cache Array Routing Protocol, 캐시 배열 간 경로지정 프로토콜)
  - 공유 웹캐시들에 동일한 웹 객체들이 중복 저장되는 것을 막기 위해 URL 공간을 분할해 각 캐시는 자신에게 배정되는 객체들만 캐싱하게 함

<br>

# 웹 캐시의 사전인출 기법

웹서비스의 응답 지연시간을 줄이기 위한 방법의 일환으로 **사용자에 의해 아직 요청되지 않은 객체를 미리 받아오는 사전인출 기법(prefetching)**의 중요성이 증가하고 있다. 웹캐시에서의 사전인출 기법은 **예측 사전인출 기법(predictive prefetching)**과 **대화식 사전인출 기법(interactive prefetching)**으로 나누어 볼 수 있다.

**예측 사전인출 기법**은 웹페이지들 간의 관계 그래프 등을 구성해 하나의 웹 페이지가 참조되었을 때, 새로운 웹페이지가 참조될 확률을 과거의 참조 기록을 통해 예측하고 이 확률을 기반으로 사전인출을 수행하는 방법을 말한다.  **대화식 사전인출 기법**은 사용자가 HTML(Hypertext Markup Language) 문서에 대한 요청을 했을 때 웹 캐시는 캐싱하고 있던 HTML 문서를 미리 파싱(parsing)해, 그 문서에 포함(embed)되거나 연결(link)된 웹 객체를 미리 받아와서 사용자의 후속 요청에 곧바로 전달하는 기법을 말한다.

<br>

# 동적 웹 객체의 캐싱 기법

- 위에서 설명한 웹캐싱 기법들은 모두 정적 웹 콘텐츠에 대한 캐싱에 초점
- 동적 웹 콘텐츠에 대한 웹캐싱은 요청받은 내용에 대해 프로그램을 실행한 후 그 결과물을 보내줘야 하기 때문에 데이터 관리에 어려움이 따름 ⇒ 즉, 동일한 요청에 대해 서로 다른 결과를 초래할 수 있기 때문에 캐싱이 의미가 없음
- 하지만 어느 정도 유사하기 때문에 캐싱 가능한 곳을 부분적으로 표시하는 태그 등을 활용해 부분적으로 캐싱하여 활용될 수 있을 것으로 기대